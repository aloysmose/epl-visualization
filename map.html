<!DOCTYPE html>
<html>
  <head>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      img {
        position: absolute;
        top: 86%;
        left: 0.6%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <a href="https://github.com/andystanley/EPL-Players-Nationality">
    <img src="logos/github.png">
</div>
    <script>
      var map;
      var infoWindow;
      var oms;
      var allMarkers = [];

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 3,
          minZoom: 2,
          maxZoom: 5,
          center: new google.maps.LatLng(45.9,24.9),
          mapTypeId: 'hybrid'
        });

        infoWindow = new google.maps.InfoWindow();

        // Create an overlapping marker spidifier
        oms = new OverlappingMarkerSpiderfier(map, {
          markersWontMove: true,
          markersWontHide: true,
          keepSpiderfied: true,
          basicFormatEvents: true,
          legWeight: 0,
          circleFootSeparation: 20, 
          spiralFootSeparation: 20,
          spiralLengthFactor: 20
        });

        // Create a <script> tag and set the USGS URL as the source.
        var script = document.createElement('script');
        // This example uses a local copy of the GeoJSON stored atepl.js
        // http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojsonp
        script.src = 'epl_data.js';
        document.getElementsByTagName('head')[0].appendChild(script);
      }

      // Loop through the results array and place a marker for each
      // set of coordinates.
      window.eqfeed_callback = function(results) {
        for (var i = 0; i < results.features.length; i++) {
          // Get the player properties
          var name = results.features[i].properties.name;
          var club = results.features[i].properties.club;
          var nationality = results.features[i].properties.nationality;
          var age = results.features[i].properties.age;
          var position = results.features[i].properties.position;
          var coords = results.features[i].geometry.coordinates;

          // Set up the players location
          var latLng = new google.maps.LatLng(coords[1],coords[0]);

          // Create the marker icon
          var icon = {
              url: 'logos/' + club + '.png', // url
              scaledSize: new google.maps.Size(20, 20), // scaled size
              origin: new google.maps.Point(0,0), // origin
              anchor: new google.maps.Point(10, 0) // anchor
          }

          // Create the marker label
          var label = {
            fontSize: '0px', // Hide the name from appearing as a label
            text: name + ', ' + age + ', ' + position + '<br>'+ 
                  nationality + ' / ' + club
          }

          // Create a marker
          var marker = new google.maps.Marker({
            position: latLng,
            map: map,
            icon: icon,
            label: label
          });

          // Add the marker to the array of the all the markers
          allMarkers.push(marker);

          // Add a listener for when a marker cluster is clicked on
          marker.addListener('spider_click', function() {
            // Set the content of the infoWindow
            infoWindow.setContent(this.label.text);
            // Open the infoWindow to the markers location
            infoWindow.open(map, this);
          });

          oms.addMarker(marker);

          // Add a listener for when the zoom is changed
          map.addListener('zoom_changed', function() {
              // For every marker, dynamically change the icon size based on the current zoom level
              for(var i = 0; i < allMarkers.length; i++) {
                var size = map.getZoom() * 10;
                allMarkers[i].icon.scaledSize = new google.maps.Size(size, size);
                allMarkers[i].icon.size = new google.maps.Size(size, size);
                allMarkers[i].setMap(map);
              }
              // Expand the size between the spiderfied markers based on the zoom level
              var seperation = oms.circleFootSeparation;
              if (map.getZoom() > 3) {
                seperation = 40;
              }
              else if (map.getZoom() < 3) {
                seperation = 15;
              }
              oms.circleFootSeparation = seperation;
              oms.spiralFootSeparation = seperation;
          });
        }
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCIczLmrse3tNr3S7EP2Hwk8gdMTAvjL9s&callback=initMap">
    </script>
    <script async defer
    src="https://cdnjs.cloudflare.com/ajax/libs/OverlappingMarkerSpiderfier/1.0.3/oms.min.js">
    </script>
  </body>
</html>